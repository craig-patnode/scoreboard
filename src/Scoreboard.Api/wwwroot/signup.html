<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Scoreboard - Sign Up</title>
	<style>
		* { margin: 0; padding: 0; box-sizing: border-box; }
		body { font-family: 'Arial', sans-serif; background: #1a1a1a; color: #fff; min-height: 100vh; display: flex; align-items: center; justify-content: center; }

		.signup-container { max-width: 420px; width: 100%; padding: 20px; }

		.signup-card {
			background: #2a2a2a; border-radius: 12px; padding: 30px;
			box-shadow: 0 4px 30px rgba(0,0,0,0.5);
		}

		.logo { text-align: center; margin-bottom: 25px; }
		.logo h1 { font-size: 24px; color: #4CAF50; letter-spacing: 2px; }
		.logo p { font-size: 12px; color: #888; margin-top: 5px; }

		.step { display: none; }
		.step.active { display: block; }

		.step-indicator { display: flex; gap: 8px; margin-bottom: 20px; justify-content: center; }
		.step-dot { width: 10px; height: 10px; border-radius: 50%; background: #444; }
		.step-dot.active { background: #4CAF50; }
		.step-dot.done { background: #81C784; }

		label { display: block; font-size: 11px; color: #888; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 4px; margin-top: 12px; }
		input, select {
			width: 100%; padding: 10px; border: 1px solid #555; background: #333;
			color: #fff; border-radius: 4px; font-size: 14px;
		}
		input:focus, select:focus { border-color: #4CAF50; outline: none; }

		.plan-cards { display: flex; gap: 10px; margin-top: 10px; }
		.plan-card {
			flex: 1; padding: 15px; background: #333; border: 2px solid #444;
			border-radius: 8px; cursor: pointer; text-align: center; transition: all 0.2s;
		}
		.plan-card.selected { border-color: #4CAF50; background: #1a3a1a; }
		.plan-card h3 { font-size: 14px; color: #fff; margin-bottom: 5px; }
		.plan-card .price { font-size: 22px; font-weight: bold; color: #4CAF50; }
		.plan-card .period { font-size: 11px; color: #888; }
		.plan-card .savings { font-size: 10px; color: #FFD700; margin-top: 5px; }

		.coupon-row { display: flex; gap: 8px; margin-top: 12px; }
		.coupon-row input { flex: 1; }
		.coupon-row button { padding: 10px 16px; font-size: 12px; background: #555; border: none; color: #fff; border-radius: 4px; cursor: pointer; }
		.coupon-status { font-size: 11px; margin-top: 4px; }
		.coupon-status.valid { color: #4CAF50; }
		.coupon-status.invalid { color: #f44336; }

		.cc-row { display: flex; gap: 10px; }
		.cc-row > div { flex: 1; }

		.btn-next, .btn-submit {
			width: 100%; padding: 12px; font-size: 14px; border: none; border-radius: 4px;
			cursor: pointer; font-weight: bold; margin-top: 20px; transition: all 0.2s;
		}
		.btn-next { background: #2196F3; color: #fff; }
		.btn-submit { background: #4CAF50; color: #fff; }
		.btn-next:hover, .btn-submit:hover { opacity: 0.9; transform: translateY(-1px); }
		.btn-back { background: none; border: none; color: #888; font-size: 12px; cursor: pointer; margin-top: 10px; display: block; text-align: center; width: 100%; }

		.error { color: #f44336; font-size: 12px; margin-top: 8px; }
		.success-screen { text-align: center; padding: 30px 0; }
		.success-screen .check { font-size: 60px; margin-bottom: 15px; }
		.success-screen h2 { color: #4CAF50; margin-bottom: 10px; }
		.success-screen p { color: #888; font-size: 13px; line-height: 1.6; }
		.success-screen .stream-key { background: #333; padding: 10px; border-radius: 4px; margin: 15px 0; font-family: monospace; color: #4CAF50; font-size: 12px; word-break: break-all; }

		.demo-notice { background: #3a2a00; border: 1px solid #FFD700; border-radius: 4px; padding: 8px; margin-bottom: 15px; font-size: 11px; color: #FFD700; text-align: center; }

		@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
		.btn-spinner {
			display: inline-block; width: 14px; height: 14px;
			border: 2px solid rgba(255, 255, 255, 0.3); border-top-color: #fff;
			border-radius: 50%; animation: spin 0.6s linear infinite;
			vertical-align: middle; margin-right: 6px;
		}
		button:disabled { opacity: 0.6; cursor: not-allowed; transform: none !important; }
	</style>
</head>
<body>
	<div class="signup-container">
		<div class="signup-card">
			<div class="logo">
				<h1>‚öΩ Scoreboard</h1>
				<p>Live Streaming Scoreboard Overlays</p>
			</div>

			<div class="step-indicator">
				<div class="step-dot active" id="dot1"></div>
				<div class="step-dot" id="dot2"></div>
				<div class="step-dot" id="dot3"></div>
			</div>

			<!-- STEP 1: Account Info -->
			<div class="step active" id="step1">
				<label>Display Name</label>
				<input type="text" id="displayName" placeholder="Your name or channel name" />
				<label>Email Address</label>
				<input type="email" id="email" placeholder="you@example.com" />
				<label>Password</label>
				<input type="password" id="password" placeholder="Min 8 characters" />
				<div class="error" id="step1Error"></div>
				<button class="btn-next" onclick="goToStep(2)">Next ‚Üí</button>
			</div>

			<!-- STEP 2: Plan Selection -->
			<div class="step" id="step2">
				<label>Choose Your Plan</label>
				<div class="plan-cards">
					<div class="plan-card selected" data-plan="MONTHLY" onclick="selectPlan(this, 'MONTHLY')">
						<h3>Monthly</h3>
						<div class="price">$9.99</div>
						<div class="period">/month</div>
					</div>
					<div class="plan-card" data-plan="YEARLY" onclick="selectPlan(this, 'YEARLY')">
						<h3>Yearly</h3>
						<div class="price">$99.99</div>
						<div class="period">/year</div>
						<div class="savings">Save ~17%!</div>
					</div>
				</div>

				<label>Have a coupon?</label>
				<div class="coupon-row">
					<input type="text" id="couponCode" placeholder="Enter code" />
					<button id="couponApplyBtn" onclick="validateCoupon()">Apply</button>
				</div>
				<div class="coupon-status" id="couponStatus"></div>

				<div class="error" id="step2Error"></div>
				<button class="btn-next" onclick="goToStep(3)">Next ‚Üí</button>
				<button class="btn-back" onclick="goToStep(1)">‚Üê Back</button>
			</div>

			<!-- STEP 3: Payment (Stubbed) -->
			<div class="step" id="step3">
				<div class="demo-notice">üß™ Payment is in test mode. No real charges.</div>

				<label>Card Number</label>
				<input type="text" id="cardNumber" placeholder="4242 4242 4242 4242" maxlength="19" />
				<div class="cc-row">
					<div>
						<label>Expiry</label>
						<input type="text" id="cardExpiry" placeholder="MM/YY" maxlength="5" />
					</div>
					<div>
						<label>CVC</label>
						<input type="text" id="cardCvc" placeholder="123" maxlength="4" />
					</div>
				</div>
				<label>Name on Card</label>
				<input type="text" id="cardName" placeholder="Full name" />

				<div class="error" id="step3Error"></div>
				<button class="btn-submit" id="submitBtn" onclick="submitSignup()">üîí Subscribe & Create Account</button>
				<button class="btn-back" onclick="goToStep(2)">‚Üê Back</button>
			</div>

			<!-- SUCCESS -->
			<div class="step" id="stepSuccess">
				<div class="success-screen">
					<div class="check">‚úÖ</div>
					<h2>Welcome to Scoreboard!</h2>
					<p>Your account has been created and you're all set to start streaming.</p>
					<div class="stream-key" id="successStreamKey"></div>
					<p style="font-size: 11px; color: #FFD700;">‚ö†Ô∏è Save your Stream Key ‚Äî you'll need it for OBS setup.</p>
					<button class="btn-next" style="margin-top: 20px;" onclick="window.location.href='/controller.html'">Go to Controller ‚Üí</button>
				</div>
			</div>
		</div>
	</div>

	<script>
		const API_BASE = window.location.origin + '/api';
		let selectedPlan = 'MONTHLY';
		let couponValid = false;

		function setButtonLoading(btn, isLoading, loadingText) {
			if (isLoading) {
				btn.disabled = true;
				btn._originalHTML = btn.innerHTML;
				btn.innerHTML = '<span class="btn-spinner"></span>' + (loadingText || btn.textContent);
			} else {
				btn.disabled = false;
				if (btn._originalHTML) btn.innerHTML = btn._originalHTML;
			}
		}

		function goToStep(step) {
			// Validate current step
			if (step === 2) {
				const name = document.getElementById('displayName').value.trim();
				const email = document.getElementById('email').value.trim();
				const pass = document.getElementById('password').value;
				if (!name || !email || pass.length < 8) {
					document.getElementById('step1Error').textContent = 'Please fill all fields. Password must be 8+ characters.';
					return;
				}
				document.getElementById('step1Error').textContent = '';
			}

			document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
			document.getElementById('step' + step).classList.add('active');

			document.querySelectorAll('.step-dot').forEach((d, i) => {
				d.classList.remove('active', 'done');
				if (i + 1 < step) d.classList.add('done');
				if (i + 1 === step) d.classList.add('active');
			});
		}

		function selectPlan(el, plan) {
			document.querySelectorAll('.plan-card').forEach(c => c.classList.remove('selected'));
			el.classList.add('selected');
			selectedPlan = plan;
		}

		async function validateCoupon() {
			const code = document.getElementById('couponCode').value.trim();
			const status = document.getElementById('couponStatus');
			if (!code) { status.textContent = ''; return; }

			const btn = document.getElementById('couponApplyBtn');
			setButtonLoading(btn, true, 'Checking‚Ä¶');
			try {
				const response = await fetch(`${API_BASE}/auth/validate-coupon/${encodeURIComponent(code)}`);
				const result = await response.json();

				if (result.isValid) {
					status.textContent = `‚úÖ ${result.message}`;
					status.className = 'coupon-status valid';
					couponValid = true;
				} else {
					status.textContent = `‚ùå ${result.message}`;
					status.className = 'coupon-status invalid';
					couponValid = false;
				}
			} catch (error) {
				status.textContent = '‚ùå Error validating coupon.';
				status.className = 'coupon-status invalid';
				couponValid = false;
			} finally {
				setButtonLoading(btn, false);
			}
		}

		async function submitSignup() {
			const btn = document.getElementById('submitBtn');
			setButtonLoading(btn, true, 'Creating Account‚Ä¶');

			const body = {
				displayName: document.getElementById('displayName').value.trim(),
				emailAddress: document.getElementById('email').value.trim(),
				password: document.getElementById('password').value,
				planCode: selectedPlan,
				couponCode: document.getElementById('couponCode').value.trim() || null
			};

			try {
				const res = await fetch(`${API_BASE}/auth/signup`, {
					method: 'POST', headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify(body)
				});
				const data = await res.json();
				if (data.success) {
					localStorage.setItem('sc_token', data.token);
					localStorage.setItem('sc_streamKey', data.streamKey);
					localStorage.setItem('sc_displayName', data.displayName);

					document.getElementById('successStreamKey').textContent = `Stream Key: ${data.streamKey}`;
					document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
					document.getElementById('stepSuccess').classList.add('active');
					document.querySelectorAll('.step-dot').forEach(d => d.classList.add('done'));
				} else {
					document.getElementById('step3Error').textContent = data.message || 'Signup failed';
				}
			} catch (e) {
				document.getElementById('step3Error').textContent = 'Connection error. Please try again.';
			} finally {
				setButtonLoading(btn, false);
			}
		}
	</script>
</body>
</html>
